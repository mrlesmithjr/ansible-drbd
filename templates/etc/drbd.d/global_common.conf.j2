# {{ ansible_managed }}
global {
	usage-count no;
}

common {
{% for section in drbd_common.keys() %}
  {{ section }} {
{%   for line in drbd_common[section].splitlines() %}
    {{ line }}
{%   endfor %}
  }
{% endfor %}
}

{% for disk in drbd_disks %}
resource {{ disk['resource'] }} {
{% for host in groups[drbd_group] %}
  on {{ hostvars[host]['inventory_hostname_short'] }} {
    {% if drbd_node_id is defined %}node-id {{ hostvars[host]['drbd_node_id'] }};
{% endif %}    device {{ disk['device'] }};
    disk {% if hostvars[host]['drbd_quorum'] is sameas false %}{{ disk['use_partition'] }}{% else %}none{% endif %};
    address {{ hostvars[host]['ansible_' + drbd_interface]['ipv4']['address'] }}:7788;
{% if hostvars[host]['drbd_quorum'] is sameas false %}    meta-disk internal;
{% endif %}
  }

{% endfor %}
{% if drbd_connection_mesh is sameas true %}  connection-mesh {
    hosts{% for host2 in groups[drbd_group] %} {{ hostvars[host2]['inventory_hostname_short'] }}{% endfor %};
  }
{% endif %}
}
{% endfor %}
